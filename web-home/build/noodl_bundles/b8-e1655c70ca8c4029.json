[{"name":"/#Logic/GetDisasters","nodes":[{"id":"d53744f0-d859-970c-8efb-458658cc23e9","type":"/#Logic/Environment","parameters":{},"ports":[],"children":[]},{"id":"210b3e3a-b1fe-b1da-1058-3c623aede2bd","type":"REST2","parameters":{"responseScript":"// Add custom code to convert the response content to outputs\n//\n//*Response.status    The status code of the response\n//*Response.content   The content of the response as a javascript\n//                    object.\n//*Response.request   The request object that resulted in the response.\n//\n//*Inputs and *Outputs contain the inputs and outputs of the node.\n\nconst DATA = Response.content;\n\nif(!DATA) return;\n\nOutputs.Pagination = Response.content?.meta?.pagination\nOutputs.DATA = Response.content?.data\nOutputs.Results = Response.DATA;"},"ports":[],"children":[]},{"id":"fc48e18e-8803-1f0f-c228-697664bcc5be","type":"JavaScriptFunction","parameters":{"functionScript":"const page = Inputs.page + 1 || 1;\r\nconst pageSize = Inputs.pageSize || 5;\r\nconst base_url = Inputs.base_url;\r\n\r\nconst keyword = Inputs.keyword;\r\nconst sort = Inputs.sort || \"desc\";\r\nconst status = Inputs.status;\r\nconst type = Inputs.type\r\nconst provinces = Inputs.provinces\r\n\r\nfunction createFilters(keyword) {\r\n  if (!keyword || typeof keyword !== \"string\") {\r\n    throw new Error(\"Keyword không hợp lệ!\");\r\n  }\r\n\r\n  const filters = [\r\n    `filters[$or][0][Name][$contains]=${keyword}`, // Tìm theo trường Name\r\n    `filters[$or][1][Description][$contains]=${keyword}`, // Tìm trong User.username\r\n    `filters[$or][2][DisasterType][DisasterTypeName][$contains]=${keyword}`, // Tìm trong User.username\r\n  ];\r\n\r\n  return `${filters.join(\"&\")}`;\r\n}\r\n\r\nlet api = `${base_url}/disasters?populate=*&pagination[page]=${page}&pagination[pageSize]=${pageSize}&sort=createdAt:${sort}`;\r\n\r\nif (keyword) {\r\n  const apiEndpoint = keyword && createFilters(keyword);\r\n  api += `&${apiEndpoint}`;\r\n}\r\n\r\nif (status) {\r\n  let filters = [];\r\n  // Chưa diễn ra\r\n  if (status == \"1\") {\r\n    filters = [`filters[StartDate][$gt]=${new Date().toISOString()}`];\r\n  }\r\n\r\n  // Đang diễn ra\r\n  if (status == \"2\") {\r\n    filters = [\r\n      `filters[StartDate][$lte]=${new Date().toISOString()}`,\r\n      `filters[$or][0][EndDate][$null]=true`,\r\n      `filters[$or][1][EndDate][$gte]=${new Date().toISOString()}`,\r\n    ];\r\n  }\r\n\r\n  // Đã diễn ra\r\n  if (status == \"3\") {\r\n    filters= [\r\n        `filters[EndDate][$lt]=${new Date().toISOString()}`\r\n    ]\r\n  }\r\n\r\n  api += `&${filters.join(\"&\")}`;\r\n}\r\n\r\nif(provinces){\r\n  api += `&filters[Provinces]=${provinces}`\r\n}\r\n\r\n\r\nif(type){\r\n  api += `&filters[DisasterType]=${type}`\r\n}\r\n\r\n\r\nOutputs.api = api;\r\n"},"ports":[{"name":"in-page","displayName":"page","plug":"input","type":"*","group":"Inputs","index":4},{"name":"in-pageSize","displayName":"pageSize","plug":"input","type":"*","group":"Inputs","index":5},{"name":"in-base_url","displayName":"base_url","plug":"input","type":"*","group":"Inputs","index":6},{"name":"in-keyword","displayName":"keyword","plug":"input","type":"*","group":"Inputs","index":7},{"name":"in-sort","displayName":"sort","plug":"input","type":"*","group":"Inputs","index":8},{"name":"in-status","displayName":"status","plug":"input","type":"*","group":"Inputs","index":9},{"name":"in-type","displayName":"type","plug":"input","type":"*","group":"Inputs","index":10},{"name":"in-provinces","displayName":"provinces","plug":"input","type":"*","group":"Inputs","index":11},{"name":"out-api","displayName":"api","plug":"output","type":"*","group":"Outputs","index":12}],"children":[]},{"id":"df4bc0af-0a3a-f6fd-f3c7-9efd899c4f9f","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"6fc2a588-0cc4-fd30-be1c-a3f3b52ba078","type":"Component Outputs","parameters":{},"ports":[],"children":[]},{"id":"e129ce2e-bf7a-9255-9066-102fb4e6ec95","type":"/Components/LoadingSpinner","parameters":{},"ports":[],"children":[]},{"id":"c388a816-8daf-0c6a-129a-96c7775d506b","type":"/#Logic/GetPaganation","parameters":{},"ports":[],"children":[]},{"id":"b7db2d31-8e31-a38c-7331-e0f4a2f33140","type":"/Components/LoadingSpinner","parameters":{},"ports":[],"children":[]}],"connections":[{"sourceId":"fc48e18e-8803-1f0f-c228-697664bcc5be","sourcePort":"out-api","targetId":"210b3e3a-b1fe-b1da-1058-3c623aede2bd","targetPort":"resource"},{"sourceId":"df4bc0af-0a3a-f6fd-f3c7-9efd899c4f9f","sourcePort":"page","targetId":"fc48e18e-8803-1f0f-c228-697664bcc5be","targetPort":"in-page"},{"sourceId":"df4bc0af-0a3a-f6fd-f3c7-9efd899c4f9f","sourcePort":"limit","targetId":"fc48e18e-8803-1f0f-c228-697664bcc5be","targetPort":"in-pageSize"},{"sourceId":"df4bc0af-0a3a-f6fd-f3c7-9efd899c4f9f","sourcePort":"keyword","targetId":"fc48e18e-8803-1f0f-c228-697664bcc5be","targetPort":"in-keyword"},{"sourceId":"df4bc0af-0a3a-f6fd-f3c7-9efd899c4f9f","sourcePort":"sort","targetId":"fc48e18e-8803-1f0f-c228-697664bcc5be","targetPort":"in-sort"},{"sourceId":"df4bc0af-0a3a-f6fd-f3c7-9efd899c4f9f","sourcePort":"status","targetId":"fc48e18e-8803-1f0f-c228-697664bcc5be","targetPort":"in-status"},{"sourceId":"df4bc0af-0a3a-f6fd-f3c7-9efd899c4f9f","sourcePort":"ProvinceId","targetId":"fc48e18e-8803-1f0f-c228-697664bcc5be","targetPort":"in-provinces"},{"sourceId":"210b3e3a-b1fe-b1da-1058-3c623aede2bd","sourcePort":"out-DATA","targetId":"6fc2a588-0cc4-fd30-be1c-a3f3b52ba078","targetPort":"Data"},{"sourceId":"210b3e3a-b1fe-b1da-1058-3c623aede2bd","sourcePort":"success","targetId":"6fc2a588-0cc4-fd30-be1c-a3f3b52ba078","targetPort":"Success"},{"sourceId":"210b3e3a-b1fe-b1da-1058-3c623aede2bd","sourcePort":"failure","targetId":"6fc2a588-0cc4-fd30-be1c-a3f3b52ba078","targetPort":"Failure"},{"sourceId":"df4bc0af-0a3a-f6fd-f3c7-9efd899c4f9f","sourcePort":"Do","targetId":"210b3e3a-b1fe-b1da-1058-3c623aede2bd","targetPort":"fetch"},{"sourceId":"df4bc0af-0a3a-f6fd-f3c7-9efd899c4f9f","sourcePort":"type","targetId":"fc48e18e-8803-1f0f-c228-697664bcc5be","targetPort":"in-type"},{"sourceId":"d53744f0-d859-970c-8efb-458658cc23e9","sourcePort":"API_URL","targetId":"fc48e18e-8803-1f0f-c228-697664bcc5be","targetPort":"in-base_url"},{"sourceId":"df4bc0af-0a3a-f6fd-f3c7-9efd899c4f9f","sourcePort":"Do","targetId":"e129ce2e-bf7a-9255-9066-102fb4e6ec95","targetPort":"Show"},{"sourceId":"e129ce2e-bf7a-9255-9066-102fb4e6ec95","sourcePort":"Done","targetId":"210b3e3a-b1fe-b1da-1058-3c623aede2bd","targetPort":"fetch"},{"sourceId":"210b3e3a-b1fe-b1da-1058-3c623aede2bd","sourcePort":"out-Pagination","targetId":"c388a816-8daf-0c6a-129a-96c7775d506b","targetPort":"Pagination"},{"sourceId":"c388a816-8daf-0c6a-129a-96c7775d506b","sourcePort":"page","targetId":"6fc2a588-0cc4-fd30-be1c-a3f3b52ba078","targetPort":"Page"},{"sourceId":"c388a816-8daf-0c6a-129a-96c7775d506b","sourcePort":"pageSize","targetId":"6fc2a588-0cc4-fd30-be1c-a3f3b52ba078","targetPort":"PageSize"},{"sourceId":"c388a816-8daf-0c6a-129a-96c7775d506b","sourcePort":"total","targetId":"6fc2a588-0cc4-fd30-be1c-a3f3b52ba078","targetPort":"total"},{"sourceId":"210b3e3a-b1fe-b1da-1058-3c623aede2bd","sourcePort":"failure","targetId":"b7db2d31-8e31-a38c-7331-e0f4a2f33140","targetPort":"Hide"},{"sourceId":"210b3e3a-b1fe-b1da-1058-3c623aede2bd","sourcePort":"success","targetId":"b7db2d31-8e31-a38c-7331-e0f4a2f33140","targetPort":"Hide"}],"ports":[{"name":"Success","type":"signal","plug":"output","index":0},{"name":"Failure","type":"signal","plug":"output","index":1},{"name":"sort","type":"*","group":"Inputs","plug":"input","index":1},{"name":"Data","type":"*","plug":"output","index":2},{"name":"status","type":"*","group":"Inputs","plug":"input","index":2},{"name":"Page","type":"*","plug":"output","index":3},{"name":"ProvinceId","type":"*","group":"Inputs","plug":"input","index":3},{"name":"PageSize","type":"*","plug":"output","index":4},{"name":"keyword","type":"*","group":"Inputs","plug":"input","index":4},{"name":"total","type":"*","plug":"output","index":5},{"name":"Do","type":{"name":"signal","allowConnectionsOnly":true},"group":"Actions","plug":"input","index":5},{"name":"page","type":"*","group":"Inputs","plug":"input","index":6},{"name":"limit","type":"*","group":"Inputs","plug":"input","index":7},{"name":"Clear","type":"*","plug":"input","index":8},{"name":"type","type":"*","group":"Inputs","plug":"input","index":9}],"roots":[]},{"name":"/#Logic/ReloadPage","nodes":[{"id":"892f2587-7059-25b5-44c8-429516984648","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"69d816c7-5f1c-2d2f-7697-373bf23e014a","type":"JavaScriptFunction","parameters":{"functionScript":"window.location.reload();"},"ports":[],"children":[]}],"connections":[{"sourceId":"892f2587-7059-25b5-44c8-429516984648","sourcePort":"Do","targetId":"69d816c7-5f1c-2d2f-7697-373bf23e014a","targetPort":"run"}],"ports":[{"name":"Do","type":{"name":"signal","allowConnectionsOnly":true},"group":"Actions","plug":"input","index":0}],"roots":[]}]