[{"name":"/page/Home","nodes":[{"id":"73a69caf-3d68-5ae0-ebf3-2c570e65eff5","type":"Page","parameters":{},"ports":[],"children":[{"id":"68dabbbf-935d-0036-19cf-3b34bb27cdd6","type":"Group","parameters":{"maxWidth":{"value":100,"unit":"vw"},"maxHeight":{"value":100,"unit":"vh"},"alignX":"center","flexDirection":"row","scrollEnabled":true,"columnGap":{"value":20,"unit":"px"},"paddingLeft":{"value":20,"unit":"px"},"paddingRight":{"value":20,"unit":"px"},"paddingTop":{"value":12,"unit":"px"},"paddingBottom":{"value":20,"unit":"px"}},"ports":[],"children":[{"id":"29548992-3e8c-6a97-ea90-22c2fffa10a3","type":"Group","parameters":{"alignItems":"flex-start","sizeMode":"explicit","alignX":"center","flexDirection":"column","scrollEnabled":false},"ports":[],"children":[{"id":"d2f68204-5d14-af3d-314c-4ccc52853a19","type":"Group","parameters":{"flexDirection":"row","columnGap":{"value":24,"unit":"px"},"marginBottom":{"value":20,"unit":"px"},"maxHeight":{"value":160,"unit":"px"}},"ports":[],"children":[{"id":"fd9e0b69-ce1f-941c-0f1a-5cbd45420eb4","type":"Group","parameters":{"maxWidth":{"value":100,"unit":"%"},"maxHeight":{"value":100,"unit":"%"},"paddingTop":{"value":12,"unit":"px"},"paddingRight":{"value":12,"unit":"px"},"paddingBottom":{"value":12,"unit":"px"},"paddingLeft":{"value":12,"unit":"px"},"flexDirection":"column","columnGap":{"value":12,"unit":"px"},"borderStyle":"solid","borderWidth":{"value":1,"unit":"px"},"borderRadius":{"value":12,"unit":"px"},"borderColor":"Border","backgroundColor":"Primary"},"ports":[],"children":[{"id":"aaeb3089-458e-f2e1-ff11-bb4eda882638","type":"Text","parameters":{"text":"Thiên tai đang diễn ra","fontSize":{"value":18,"unit":"px"},"color":"#FFFFFF"},"ports":[],"children":[]},{"id":"e9de3434-b586-fe95-b82e-22245d0ce916","type":"Text","parameters":{"text":"0","fontSize":{"value":60,"unit":"px"},"color":"#FFFFFF","fontFamily":"fonts/Roboto/Roboto-Bold.ttf","sizeMode":"contentHeight","textAlignX":"center","textAlignY":"center","alignY":"center","lineHeight":{"value":60,"unit":"px"}},"ports":[],"children":[]},{"id":"2d8cb535-2f52-f9c2-4f93-c2e28f2d735b","type":"net.noodl.controls.button","parameters":{"label":"Xem tất cả","alignX":"right","backgroundColor":"#00000000"},"stateParameters":{"hover":{"fontFamily":"fonts/Roboto/Roboto-Bold.ttf"}},"ports":[],"children":[]}]},{"id":"7cf92117-3d4c-b71b-91e5-49d253c1fdfc","type":"Group","parameters":{"maxWidth":{"value":100,"unit":"%"},"maxHeight":{"value":100,"unit":"%"},"paddingTop":{"value":12,"unit":"px"},"paddingRight":{"value":12,"unit":"px"},"paddingBottom":{"value":12,"unit":"px"},"paddingLeft":{"value":12,"unit":"px"},"flexDirection":"column","columnGap":{"value":12,"unit":"px"},"borderStyle":"solid","borderWidth":{"value":1,"unit":"px"},"borderRadius":{"value":12,"unit":"px"},"borderColor":"#E7E7E9","backgroundColor":"#5B31FF00"},"ports":[],"children":[{"id":"007457b5-1e06-4f48-c26f-613448bfd6b1","type":"Text","parameters":{"text":"Yêu cầu hỗ trợ","fontSize":{"value":18,"unit":"px"},"color":"#000000"},"ports":[],"children":[]},{"id":"35c28824-d6e8-d37d-688d-15ce467dd756","type":"Text","parameters":{"text":"0","fontSize":{"value":60,"unit":"px"},"color":"#000000","fontFamily":"fonts/Roboto/Roboto-Bold.ttf","sizeMode":"contentHeight","textAlignX":"center","textAlignY":"center","alignY":"center","lineHeight":{"value":60,"unit":"px"}},"ports":[],"children":[]},{"id":"a8f4bdde-580d-9bc7-a9ac-19f7aa1ca9e9","type":"net.noodl.controls.button","parameters":{"label":"Xem tất cả","alignX":"right","backgroundColor":"transparent","color":"#000000"},"stateParameters":{"hover":{"fontFamily":"fonts/Roboto/Roboto-Bold.ttf"}},"ports":[],"children":[]}]},{"id":"90d52963-2d58-88e2-9f30-56b4c9f45902","type":"Group","parameters":{"maxWidth":{"value":100,"unit":"%"},"maxHeight":{"value":100,"unit":"%"},"paddingTop":{"value":12,"unit":"px"},"paddingRight":{"value":12,"unit":"px"},"paddingBottom":{"value":12,"unit":"px"},"paddingLeft":{"value":12,"unit":"px"},"flexDirection":"column","columnGap":{"value":12,"unit":"px"},"borderStyle":"solid","borderWidth":{"value":1,"unit":"px"},"borderRadius":{"value":12,"unit":"px"},"borderColor":"#E7E7E9","backgroundColor":"#5B31FF00"},"ports":[],"children":[{"id":"a1e427eb-4c8a-056f-a83d-925508b54b41","type":"Text","parameters":{"text":"Đơn vị hổ trợ","fontSize":{"value":18,"unit":"px"},"color":"#000000"},"ports":[],"children":[]},{"id":"60d236c0-b7f5-e84d-9477-a6343fd94ef4","type":"Text","parameters":{"text":"0","fontSize":{"value":60,"unit":"px"},"color":"#000000","fontFamily":"fonts/Roboto/Roboto-Bold.ttf","sizeMode":"contentHeight","textAlignX":"center","textAlignY":"center","alignY":"center","lineHeight":{"value":60,"unit":"px"}},"ports":[],"children":[]},{"id":"51456fcc-56a5-d229-5d07-70e02e09a78d","type":"net.noodl.controls.button","parameters":{"label":"Xem tất cả","alignX":"right","backgroundColor":"#00000000","color":"#000000"},"stateParameters":{"hover":{"fontFamily":"fonts/Roboto/Roboto-Bold.ttf"}},"ports":[],"children":[]}]}]},{"id":"742b194b-02f6-b261-ecbb-9efb7f4a66d1","type":"Group","parameters":{"flexDirection":"row","columnGap":{"value":24,"unit":"px"},"minHeight":{"value":400,"unit":"px"},"marginBottom":{"value":12,"unit":"px"}},"ports":[],"children":[{"id":"c2e8a4c5-22fb-32f0-63b4-1c2a48f77b22","type":"Group","parameters":{"maxWidth":{"value":100,"unit":"%"},"maxHeight":{"value":100,"unit":"%"},"paddingTop":{"value":12,"unit":"px"},"paddingRight":{"value":12,"unit":"px"},"paddingBottom":{"value":12,"unit":"px"},"paddingLeft":{"value":12,"unit":"px"},"flexDirection":"column","columnGap":{"value":12,"unit":"px"},"borderStyle":"solid","borderWidth":{"value":1,"unit":"px"},"borderRadius":{"value":12,"unit":"px"},"borderColor":"#E7E7E9","backgroundColor":"#5B31FF00","rowGap":{"value":12,"unit":"px"}},"ports":[],"children":[{"id":"6fa72dd2-4f42-7b31-9649-6015ba10067e","type":"Group","parameters":{"sizeMode":"contentSize","flexDirection":"row","alignItems":"center","justifyContent":"flex-start","columnGap":{"value":8,"unit":"px"}},"ports":[],"children":[{"id":"4708a733-192d-c2aa-50ff-0e80c7cf0e85","type":"Text","parameters":{"text":"Thiên tai","fontSize":{"value":18,"unit":"px"},"color":"#000000","alignY":"center","textAlignY":"center"},"ports":[],"children":[]}]},{"id":"6b1a4548-b634-beb0-0e33-897198f58719","type":"Group","parameters":{},"ports":[],"children":[{"id":"c4da1398-238b-617e-d5c7-3a93f4566a2e","type":"/component/MapboxThienTai","parameters":{},"ports":[],"children":[]}]}]}]}]},{"id":"e2ccdf32-b94a-8397-5ef6-7c86e5b3c9d4","type":"Group","parameters":{"backgroundColor":"#FF636300","maxHeight":{"value":100,"unit":"%"},"minHeight":{"value":100,"unit":"%"},"minWidth":{"value":200,"unit":"px"},"maxWidth":{"value":400,"unit":"px"}},"ports":[],"children":[{"id":"616df25b-be69-cb39-055e-bc9e43fcbd45","type":"Group","parameters":{"maxWidth":{"value":100,"unit":"%"},"maxHeight":{"value":400,"unit":"px"},"paddingTop":{"value":12,"unit":"px"},"paddingRight":{"value":12,"unit":"px"},"paddingBottom":{"value":12,"unit":"px"},"paddingLeft":{"value":12,"unit":"px"},"flexDirection":"column","columnGap":{"value":12,"unit":"px"},"borderStyle":"solid","borderWidth":{"value":1,"unit":"px"},"borderRadius":{"value":12,"unit":"px"},"borderColor":"#E7E7E9","marginBottom":{"value":20,"unit":"px"}},"ports":[],"children":[{"id":"b275e45b-c5a7-0fbb-1eb4-ea8a8c8b0087","type":"Text","parameters":{"text":"Yêu cầu","fontSize":{"value":18,"unit":"px"},"fontFamily":"fonts/Roboto/Roboto-Medium.ttf","textAlignX":"center","marginBottom":{"value":20,"unit":"px"}},"ports":[],"children":[]},{"id":"4978e280-2aff-4733-d32c-d8001e0ef1cf","type":"Doughnut Chart","parameters":{"plugins.decimation.algorithm":"min-max"},"ports":[],"children":[]}]},{"id":"660f2df0-2109-3c1f-f6a1-a239868c9ac0","type":"Group","parameters":{"maxWidth":{"value":100,"unit":"%"},"maxHeight":{"value":400,"unit":"px"},"paddingTop":{"value":12,"unit":"px"},"paddingRight":{"value":12,"unit":"px"},"paddingBottom":{"value":12,"unit":"px"},"paddingLeft":{"value":12,"unit":"px"},"flexDirection":"column","columnGap":{"value":12,"unit":"px"},"borderStyle":"solid","borderWidth":{"value":1,"unit":"px"},"borderRadius":{"value":12,"unit":"px"},"borderColor":"#E7E7E9"},"ports":[],"children":[{"id":"d261749f-38a7-e197-e528-a8abe4aa58b0","type":"Text","parameters":{"text":"Thiên tai","fontSize":{"value":18,"unit":"px"},"fontFamily":"fonts/Roboto/Roboto-Medium.ttf","textAlignX":"center","marginBottom":{"value":20,"unit":"px"}},"ports":[],"children":[]},{"id":"cab4dd3f-307a-8367-2e1c-08a1ebd11c8d","type":"Doughnut Chart","parameters":{"plugins.decimation.algorithm":"min-max"},"ports":[],"children":[]}]}]}]}]},{"id":"4c57dea7-0ffa-0ca2-d557-e600f57703a3","type":"PageInputs","parameters":{},"ports":[],"children":[]},{"id":"85c7c68d-3bbc-cebd-ce93-4ef5da32c933","type":"RouterNavigate","parameters":{"router":"Main","target":"/page/thien tai"},"ports":[],"children":[]},{"id":"a47dbc34-e1da-1d5e-8ebe-b810f999d5de","type":"RouterNavigate","parameters":{"router":"Main","target":"/page/Yeu cau"},"ports":[],"children":[]},{"id":"5f3da79c-a421-3c05-5441-11b6a2b42112","type":"RouterNavigate","parameters":{"router":"Main","target":"/page/To chuc"},"ports":[],"children":[]},{"id":"797a89b7-aa11-0b1f-1dfd-cdc1fdce35fb","type":"JavaScriptFunction","parameters":{"functionScript":"\r\nconst tong = Inputs.tong\r\nconst chuaXuLy = Inputs.chuaXuLy\r\nconst DangXuLy = Inputs.DangXuLy\r\nconst DaXuLy = Inputs.DaXuLy\r\n\r\nOutputs.Data = {\r\n    labels: [\"Chưa xử lý\", \"Đang xử lý\", \"Đã xử lý\"],\r\n    datasets: [\r\n        {\r\n            label: \"Dataset 1\",\r\n            data: [chuaXuLy, DangXuLy, DaXuLy],\r\n            backgroundColor: [\r\n                \"rgb(255, 99, 132)\",\r\n                \"rgb(255, 159, 64)\",\r\n                \"rgb(110, 255, 140)\",\r\n            ]\r\n        }\r\n    ]\r\n}"},"ports":[{"name":"in-tong","displayName":"tong","plug":"input","type":"*","group":"Inputs","index":4},{"name":"in-chuaXuLy","displayName":"chuaXuLy","plug":"input","type":"*","group":"Inputs","index":5},{"name":"in-DangXuLy","displayName":"DangXuLy","plug":"input","type":"*","group":"Inputs","index":6},{"name":"in-DaXuLy","displayName":"DaXuLy","plug":"input","type":"*","group":"Inputs","index":7},{"name":"out-Data","displayName":"Data","plug":"output","type":"*","group":"Outputs","index":8}],"children":[]},{"id":"4c43df60-6463-0599-a34a-db810dc88b2d","type":"/#Logic/GetAllYeuCau","parameters":{},"ports":[],"children":[]},{"id":"ad24feaa-fb2d-b351-78ad-f8086902bf18","type":"JavaScriptFunction","parameters":{"functionScript":"Outputs.Chua = 1\r\nOutputs.Dang = 2\r\nOutputs.Da = 3"},"ports":[{"name":"out-Chua","displayName":"Chua","plug":"output","type":"*","group":"Outputs","index":4},{"name":"out-Dang","displayName":"Dang","plug":"output","type":"*","group":"Outputs","index":5},{"name":"out-Da","displayName":"Da","plug":"output","type":"*","group":"Outputs","index":6}],"children":[]},{"id":"80aa3774-76d2-079e-b06b-eb901012caae","type":"/#Logic/GetAllYeuCau","parameters":{},"ports":[],"children":[]},{"id":"f4324955-bf49-adf8-8687-4cdb5fac6cb2","type":"/#Logic/GetAllYeuCau","parameters":{},"ports":[],"children":[]},{"id":"394ee9bc-bf67-0d17-bd19-73afb88554ba","type":"/#Logic/GetAllThienTai","parameters":{},"ports":[],"children":[]},{"id":"8179fb5a-4e1f-a521-e6e4-b409726519dc","type":"JavaScriptFunction","parameters":{"functionScript":"\r\nconst chuaXayRa = Inputs.chuaXayRa\r\nconst DangXayRa = Inputs.DangXayRa\r\nconst DaKetThuc = Inputs.DaKetThuc\r\n\r\nOutputs.Data = {\r\n    labels: [\"Chưa xảy ra\", \"Đang xảy ra\", \"Đã xảy ra\"],\r\n    datasets: [\r\n        {\r\n            label: \"Dataset 1\",\r\n            data: [chuaXayRa, DangXayRa, DaKetThuc],\r\n            backgroundColor: [\r\n                \"rgb(255, 99, 132)\",\r\n                \"rgb(255, 159, 64)\",\r\n                \"rgb(110, 255, 140)\",\r\n            ]\r\n        }\r\n    ]\r\n}"},"ports":[{"name":"in-chuaXayRa","displayName":"chuaXayRa","plug":"input","type":"*","group":"Inputs","index":4},{"name":"in-DangXayRa","displayName":"DangXayRa","plug":"input","type":"*","group":"Inputs","index":5},{"name":"in-DaKetThuc","displayName":"DaKetThuc","plug":"input","type":"*","group":"Inputs","index":6},{"name":"out-Data","displayName":"Data","plug":"output","type":"*","group":"Outputs","index":7}],"children":[]},{"id":"988465ff-b5dc-b9f5-482b-d3fafec36e36","type":"/#Logic/GetAllThienTai","parameters":{},"ports":[],"children":[]},{"id":"4ad4173f-210c-090e-9c85-5104dede8d0e","type":"/#Logic/GetAllThienTai","parameters":{},"ports":[],"children":[]},{"id":"2430d83b-2141-da0b-e4d3-42cca322a042","type":"/#Logic/GetAllYeuCau","parameters":{},"ports":[],"children":[]},{"id":"953b641a-34a9-08a0-a6ad-3d1b65ccef72","type":"/#Logic/GetAllToChuc","parameters":{},"ports":[],"children":[]},{"id":"954005df-91cc-c96f-a754-3927b6bbb624","type":"/#Logic/UpdateTinhThienTai","parameters":{},"ports":[],"children":[]}],"connections":[{"sourceId":"2d8cb535-2f52-f9c2-4f93-c2e28f2d735b","sourcePort":"onClick","targetId":"85c7c68d-3bbc-cebd-ce93-4ef5da32c933","targetPort":"navigate"},{"sourceId":"a8f4bdde-580d-9bc7-a9ac-19f7aa1ca9e9","sourcePort":"onClick","targetId":"a47dbc34-e1da-1d5e-8ebe-b810f999d5de","targetPort":"navigate"},{"sourceId":"51456fcc-56a5-d229-5d07-70e02e09a78d","sourcePort":"onClick","targetId":"5f3da79c-a421-3c05-5441-11b6a2b42112","targetPort":"navigate"},{"sourceId":"797a89b7-aa11-0b1f-1dfd-cdc1fdce35fb","sourcePort":"out-Data","targetId":"4978e280-2aff-4733-d32c-d8001e0ef1cf","targetPort":"data"},{"sourceId":"73a69caf-3d68-5ae0-ebf3-2c570e65eff5","sourcePort":"didMount","targetId":"4c43df60-6463-0599-a34a-db810dc88b2d","targetPort":"Do"},{"sourceId":"73a69caf-3d68-5ae0-ebf3-2c570e65eff5","sourcePort":"didMount","targetId":"80aa3774-76d2-079e-b06b-eb901012caae","targetPort":"Do"},{"sourceId":"73a69caf-3d68-5ae0-ebf3-2c570e65eff5","sourcePort":"didMount","targetId":"f4324955-bf49-adf8-8687-4cdb5fac6cb2","targetPort":"Do"},{"sourceId":"4c43df60-6463-0599-a34a-db810dc88b2d","sourcePort":"total","targetId":"797a89b7-aa11-0b1f-1dfd-cdc1fdce35fb","targetPort":"in-chuaXuLy"},{"sourceId":"80aa3774-76d2-079e-b06b-eb901012caae","sourcePort":"total","targetId":"797a89b7-aa11-0b1f-1dfd-cdc1fdce35fb","targetPort":"in-DangXuLy"},{"sourceId":"f4324955-bf49-adf8-8687-4cdb5fac6cb2","sourcePort":"total","targetId":"797a89b7-aa11-0b1f-1dfd-cdc1fdce35fb","targetPort":"in-DaXuLy"},{"sourceId":"73a69caf-3d68-5ae0-ebf3-2c570e65eff5","sourcePort":"didMount","targetId":"394ee9bc-bf67-0d17-bd19-73afb88554ba","targetPort":"Do"},{"sourceId":"ad24feaa-fb2d-b351-78ad-f8086902bf18","sourcePort":"out-Chua","targetId":"4c43df60-6463-0599-a34a-db810dc88b2d","targetPort":"status"},{"sourceId":"ad24feaa-fb2d-b351-78ad-f8086902bf18","sourcePort":"out-Dang","targetId":"80aa3774-76d2-079e-b06b-eb901012caae","targetPort":"status"},{"sourceId":"ad24feaa-fb2d-b351-78ad-f8086902bf18","sourcePort":"out-Da","targetId":"f4324955-bf49-adf8-8687-4cdb5fac6cb2","targetPort":"status"},{"sourceId":"ad24feaa-fb2d-b351-78ad-f8086902bf18","sourcePort":"out-Chua","targetId":"394ee9bc-bf67-0d17-bd19-73afb88554ba","targetPort":"status"},{"sourceId":"73a69caf-3d68-5ae0-ebf3-2c570e65eff5","sourcePort":"didMount","targetId":"988465ff-b5dc-b9f5-482b-d3fafec36e36","targetPort":"Do"},{"sourceId":"73a69caf-3d68-5ae0-ebf3-2c570e65eff5","sourcePort":"didMount","targetId":"4ad4173f-210c-090e-9c85-5104dede8d0e","targetPort":"Do"},{"sourceId":"ad24feaa-fb2d-b351-78ad-f8086902bf18","sourcePort":"out-Dang","targetId":"988465ff-b5dc-b9f5-482b-d3fafec36e36","targetPort":"status"},{"sourceId":"ad24feaa-fb2d-b351-78ad-f8086902bf18","sourcePort":"out-Da","targetId":"4ad4173f-210c-090e-9c85-5104dede8d0e","targetPort":"status"},{"sourceId":"394ee9bc-bf67-0d17-bd19-73afb88554ba","sourcePort":"total","targetId":"8179fb5a-4e1f-a521-e6e4-b409726519dc","targetPort":"in-chuaXayRa"},{"sourceId":"988465ff-b5dc-b9f5-482b-d3fafec36e36","sourcePort":"total","targetId":"8179fb5a-4e1f-a521-e6e4-b409726519dc","targetPort":"in-DangXayRa"},{"sourceId":"4ad4173f-210c-090e-9c85-5104dede8d0e","sourcePort":"total","targetId":"8179fb5a-4e1f-a521-e6e4-b409726519dc","targetPort":"in-DaKetThuc"},{"sourceId":"8179fb5a-4e1f-a521-e6e4-b409726519dc","sourcePort":"out-Data","targetId":"cab4dd3f-307a-8367-2e1c-08a1ebd11c8d","targetPort":"data"},{"sourceId":"988465ff-b5dc-b9f5-482b-d3fafec36e36","sourcePort":"total","targetId":"e9de3434-b586-fe95-b82e-22245d0ce916","targetPort":"text"},{"sourceId":"73a69caf-3d68-5ae0-ebf3-2c570e65eff5","sourcePort":"didMount","targetId":"2430d83b-2141-da0b-e4d3-42cca322a042","targetPort":"Do"},{"sourceId":"2430d83b-2141-da0b-e4d3-42cca322a042","sourcePort":"total","targetId":"35c28824-d6e8-d37d-688d-15ce467dd756","targetPort":"text"},{"sourceId":"73a69caf-3d68-5ae0-ebf3-2c570e65eff5","sourcePort":"didMount","targetId":"953b641a-34a9-08a0-a6ad-3d1b65ccef72","targetPort":"Do"},{"sourceId":"953b641a-34a9-08a0-a6ad-3d1b65ccef72","sourcePort":"total","targetId":"60d236c0-b7f5-e84d-9477-a6343fd94ef4","targetPort":"text"},{"sourceId":"73a69caf-3d68-5ae0-ebf3-2c570e65eff5","sourcePort":"didMount","targetId":"954005df-91cc-c96f-a754-3927b6bbb624","targetPort":"Do"},{"sourceId":"954005df-91cc-c96f-a754-3927b6bbb624","sourcePort":"Success","targetId":"c4da1398-238b-617e-d5c7-3a93f4566a2e","targetPort":"Mounted"}],"ports":[],"roots":["73a69caf-3d68-5ae0-ebf3-2c570e65eff5"]},{"name":"/component/MapboxThienTai","nodes":[{"id":"830194f5-39f8-a904-4a35-a2a31475d893","type":"Group","parameters":{"sizeMode":"contentSize","minWidth":{"value":100,"unit":"%"},"minHeight":{"value":100,"unit":"%"},"maxWidth":{"value":100,"unit":"%"},"maxHeight":{"value":100,"unit":"%"},"mounted":false},"ports":[],"children":[{"id":"895cf3d0-9bc8-02c9-e147-c1e4acae2514","type":"module.inlineHtml","parameters":{"html":"<div id=\"map\" style=\"width: 100%; height: 100%\"></div>\r\n<script>\r\n  // tọa độ giữa tỉnh (các tỉnh đang bị thiên tai)\r\n  function calculateCenter(points) {\r\n    // Kiểm tra xem danh sách tọa độ có rỗng hay không\r\n    if (!points || points.length === 0) {\r\n      return null; // Không có tọa độ nào để tính\r\n    }\r\n\r\n    let totalX = 0,\r\n      totalY = 0;\r\n\r\n    // Duyệt qua danh sách tọa độ và tính tổng\r\n    points.forEach((point) => {\r\n      totalX += point.lng;\r\n      totalY += point.lat;\r\n    });\r\n\r\n    // Tính trung bình cộng\r\n    const centerX = totalX / points.length;\r\n    const centerY = totalY / points.length;\r\n\r\n    // Trả về tọa độ trung tâm\r\n    return { lng: centerX, lat: centerY };\r\n  }\r\n\r\n  // Hàm chuẩn hóa chuỗi\r\n  function normalizeString(str) {\r\n    return str\r\n      .replace(/Tỉnh/g, \"\")\r\n      .replace(/Thành phố/g, \"\")\r\n      .trim(); // Xóa khoảng trắng đầu và cuối chuỗi\r\n  }\r\n\r\n  function updatePosition(position) {\r\n    const { latitude, longitude } = position.coords;\r\n    console.log({ latitude, longitude });\r\n    marker.setLngLat([longitude, latitude]);\r\n  }\r\n\r\n  // khai báo\r\n  function createMapbox() {\r\n    mapboxgl.accessToken =\r\n      \"pk.eyJ1IjoiZGhpZXAyMzA3IiwiYSI6ImNtNDRpeDFtejBuNzkycHB6bXp6eWZ1MTQifQ.169cDiC_Q2YWzRBdIxxgPg\";\r\n\r\n    const provinces = localStorage.getItem(\"provinces\")\r\n      ? JSON.parse(localStorage.getItem(\"provinces\"))\r\n      : [];\r\n\r\n    const provinceNames = provinces?.map((province) =>\r\n      normalizeString(province.name)\r\n    );\r\n\r\n    // Lấy vị trí ở giữa các tỉnh\r\n    let center = {\r\n      lng: 108,\r\n      lat: 14,\r\n    };\r\n\r\n    let zoom = 6;\r\n\r\n    if (provinces.length > 0) {\r\n      const posList = provinces.map((province) => province.location);\r\n      center = calculateCenter(posList);\r\n      zoom = 11 - provinces?.length / 2;\r\n    }\r\n\r\n    // Không sửa\r\n    map = new mapboxgl.Map({\r\n      style: \"mapbox://styles/dhiep2307/cm44mghvy011l01sd5cci6k20\", // stylesheet location\r\n      container: \"map\", // container ID\r\n      center: [center.lng, center.lat], // starting position [lng, lat]. Note that lat must be set between -90 and 90\r\n      zoom: zoom, // starting zoom\r\n    });\r\n\r\n    marker = new mapboxgl.Marker();\r\n\r\n    map.on(\"load\", function () {\r\n      map.addSource(\"diaphanhuyen-4apinm\", {\r\n        type: \"vector\",\r\n        url: \"mapbox://dhiep2307.0va1jnhw\",\r\n      });\r\n\r\n      if (provinces.length > 0) {\r\n        map.addLayer({\r\n          id: \"loc-tinh\",\r\n          type: \"fill\",\r\n          source: \"diaphanhuyen-4apinm\",\r\n          \"source-layer\": \"diaphanhuyen-4apinm\",\r\n          layout: {},\r\n          paint: {\r\n            \"fill-color\": \"#ff6666\",\r\n            \"fill-opacity\": 0.2,\r\n          },\r\n          filter: [\"in\", \"Ten_Tinh\", ...provinceNames],\r\n        });\r\n\r\n        provinces.forEach((e) => {\r\n          map.addLayer({\r\n            id: \"text-layer-tinh-\" + e.name,\r\n            type: \"symbol\",\r\n            source: {\r\n              type: \"geojson\",\r\n              data: {\r\n                type: \"FeatureCollection\",\r\n                features: [\r\n                  {\r\n                    type: \"Feature\",\r\n                    geometry: {\r\n                      type: \"Point\",\r\n                      coordinates: [e.location.lng, e.location.lat],\r\n                    },\r\n                    properties: {\r\n                      title: `${e.name}`, // Văn bản sẽ hiển thị\r\n                    },\r\n                  },\r\n                ],\r\n              },\r\n            },\r\n            layout: {\r\n              \"text-field\": [\"get\", \"title\"], // Lấy giá trị từ thuộc tính 'title' để hiển thị\r\n              \"text-size\": [\r\n                \"interpolate\", // Biểu thức interpolate giúp thay đổi kích thước theo zoom\r\n                [\"linear\"], // Mức độ thay đổi là tuyến tính\r\n                [\"zoom\"], // Sử dụng zoom level để điều chỉnh\r\n                5,\r\n                9, // Zoom level 5: 10px (kích thước chữ nhỏ)\r\n                15,\r\n                30, // Zoom level 15: 30px (kích thước chữ lớn)\r\n              ], // Kích thước chữ\r\n              \"text-anchor\": \"center\", // Căn chỉnh chữ theo giữa điểm\r\n              \"text-offset\": [0, 0], // Định vị trí chữ (tùy chọn)\r\n            },\r\n            paint: {\r\n              \"text-color\": \"#186bf0\", // Màu chữ\r\n              \"text-halo-color\": \"#FFFFFF\", // Màu viền chữ\r\n              \"text-halo-width\": 2, // Độ rộng viền chữ\r\n            },\r\n          });\r\n        });\r\n      }\r\n\r\n      // // Add zoom and rotation controls to the map.\r\n      map.addControl(new mapboxgl.NavigationControl());\r\n      map.addControl(new mapboxgl.FullscreenControl());\r\n\r\n      // Không sửa\r\n      //Thêm layer HS, TS\r\n\r\n      map.addLayer({\r\n        id: \"text-layer-truong-sa\",\r\n        type: \"symbol\",\r\n        source: {\r\n          type: \"geojson\",\r\n          data: {\r\n            type: \"FeatureCollection\",\r\n            features: [\r\n              {\r\n                type: \"Feature\",\r\n                geometry: {\r\n                  type: \"Point\",\r\n                  coordinates: [113.81768, 9.46653],\r\n                },\r\n                properties: {\r\n                  title: \"Quần đảo Trường Sa (Việt Nam)\",\r\n                },\r\n              },\r\n            ],\r\n          },\r\n        },\r\n        layout: {\r\n          \"text-field\": [\"get\", \"title\"], // Lấy giá trị từ thuộc tính 'title' để hiển thị\r\n          \"text-size\": [\r\n            \"interpolate\", // Biểu thức interpolate giúp thay đổi kích thước theo zoom\r\n            [\"linear\"], // Mức độ thay đổi là tuyến tính\r\n            [\"zoom\"], // Sử dụng zoom level để điều chỉnh\r\n            5,\r\n            9, // Zoom level 5: 10px (kích thước chữ nhỏ)\r\n            15,\r\n            30, // Zoom level 15: 30px (kích thước chữ lớn)\r\n          ], // Kích thước chữ\r\n          \"text-anchor\": \"center\", // Căn chỉnh chữ theo giữa điểm\r\n          \"text-offset\": [0, 0], // Định vị trí chữ (tùy chọn)\r\n        },\r\n        paint: {\r\n          \"text-color\": \"#186bf0\", // Màu chữ\r\n          \"text-halo-color\": \"#FFFFFF\", // Màu viền chữ\r\n          \"text-halo-width\": 2, // Độ rộng viền chữ\r\n        },\r\n      });\r\n\r\n      map.addLayer({\r\n        id: \"text-layer-hoang-sa\",\r\n        type: \"symbol\",\r\n        source: {\r\n          type: \"geojson\",\r\n          data: {\r\n            type: \"FeatureCollection\",\r\n            features: [\r\n              {\r\n                type: \"Feature\",\r\n                geometry: {\r\n                  type: \"Point\",\r\n                  coordinates: [111.90739, 16.50884],\r\n                },\r\n                properties: {\r\n                  title: \"Quần đảo Hoàng Sa (Việt Nam)\", // Văn bản sẽ hiển thị\r\n                },\r\n              },\r\n            ],\r\n          },\r\n        },\r\n        layout: {\r\n          \"text-field\": [\"get\", \"title\"], // Lấy giá trị từ thuộc tính 'title' để hiển thị\r\n          \"text-size\": [\r\n            \"interpolate\", // Biểu thức interpolate giúp thay đổi kích thước theo zoom\r\n            [\"linear\"], // Mức độ thay đổi là tuyến tính\r\n            [\"zoom\"], // Sử dụng zoom level để điều chỉnh\r\n            5,\r\n            9, // Zoom level 5: 10px (kích thước chữ nhỏ)\r\n            15,\r\n            30, // Zoom level 15: 30px (kích thước chữ lớn)\r\n          ], // Kích thước chữ\r\n          \"text-anchor\": \"center\", // Căn chỉnh chữ theo giữa điểm\r\n          \"text-offset\": [0, 0], // Định vị trí chữ (tùy chọn)\r\n        },\r\n        paint: {\r\n          \"text-color\": \"#186bf0\", // Màu chữ\r\n          \"text-halo-color\": \"#FFFFFF\", // Màu viền chữ\r\n          \"text-halo-width\": 2, // Độ rộng viền chữ\r\n        },\r\n      });\r\n\r\n      map.addLayer({\r\n        id: \"text-layer-bien-dong\",\r\n        type: \"symbol\",\r\n        source: {\r\n          type: \"geojson\",\r\n          data: {\r\n            type: \"FeatureCollection\",\r\n            features: [\r\n              {\r\n                type: \"Feature\",\r\n                geometry: {\r\n                  type: \"Point\",\r\n                  coordinates: [113.23996, 13.84156],\r\n                },\r\n                properties: {\r\n                  title: \"Biển Đông\", // Văn bản sẽ hiển thị\r\n                },\r\n              },\r\n            ],\r\n          },\r\n        },\r\n        layout: {\r\n          \"text-field\": [\"get\", \"title\"], // Lấy giá trị từ thuộc tính 'title' để hiển thị\r\n          \"text-size\": [\r\n            \"interpolate\", // Biểu thức interpolate giúp thay đổi kích thước theo zoom\r\n            [\"linear\"], // Mức độ thay đổi là tuyến tính\r\n            [\"zoom\"], // Sử dụng zoom level để điều chỉnh\r\n            14,\r\n            16, // Zoom level 5: 10px (kích thước chữ nhỏ)\r\n            18,\r\n            30, // Zoom level 15: 30px (kích thước chữ lớn)\r\n          ], // Kích thước chữ\r\n          \"text-anchor\": \"center\", // Căn chỉnh chữ theo giữa điểm\r\n          \"text-offset\": [0, 0], // Định vị trí chữ (tùy chọn)\r\n        },\r\n        paint: {\r\n          \"text-color\": \"#186bf0\", // Màu chữ\r\n          \"text-halo-color\": \"#FFFFFF\", // Màu viền chữ\r\n          \"text-halo-width\": 2, // Độ rộng viền chữ\r\n        },\r\n      });\r\n    });\r\n  }\r\n\r\n  createMapbox();\r\n</script>\r\n","styleCss":"/* background-color: red; */\r\n\r\nwidth: 100%;\r\nheight: 100%;","runJs":true},"ports":[],"children":[]}]},{"id":"4c353105-5cc4-5f32-1ad1-57258eaa96c0","type":"Component Inputs","parameters":{},"ports":[],"children":[]}],"connections":[{"sourceId":"4c353105-5cc4-5f32-1ad1-57258eaa96c0","sourcePort":"Mounted","targetId":"830194f5-39f8-a904-4a35-a2a31475d893","targetPort":"mounted"}],"ports":[{"name":"Mounted","type":"boolean","default":false,"group":"General","plug":"input","index":1}],"roots":["830194f5-39f8-a904-4a35-a2a31475d893"]},{"name":"/#Logic/UpdateTinhThienTai","nodes":[{"id":"ad6e8f2d-d19d-4bde-4b9e-a307a3769a36","type":"JavaScriptFunction","parameters":{"functionScript":"const data = Inputs.data;\r\n\r\nfunction extractProvinces(data) {\r\n    const seen = new Set();\r\n    return data.flatMap((item) =>\r\n        item.Provinces.map((province) => ({\r\n            name: province.FullName,\r\n            location: {\r\n                lat: parseFloat(province.Latitude) || 0,\r\n                lng: parseFloat(province.Longitude) || 0,\r\n            },\r\n        }))\r\n    ).filter(province => {\r\n        if (seen.has(province.name)) {\r\n            return false;\r\n        } else {\r\n            seen.add(province.name);\r\n            return true;\r\n        }\r\n    });\r\n}\r\n\r\nif (data) {\r\n    const provinces = extractProvinces(data);\r\n\r\n    const oldProvinces = JSON.parse(localStorage.getItem(\"provinces\")) || [];\r\n\r\n    if (JSON.stringify(provinces) === JSON.stringify(oldProvinces)) {\r\n        Outputs.Success = true\r\n        return;\r\n    } else {\r\n        if (provinces !== undefined) {\r\n            localStorage.setItem(\"provinces\", JSON.stringify(provinces));\r\n            Outputs.Success = true\r\n            return;\r\n        }\r\n    }\r\n}\r\n"},"ports":[{"name":"in-data","displayName":"data","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-Success","displayName":"Success","plug":"output","type":"*","group":"Outputs","index":5}],"children":[]},{"id":"3275d10f-e354-106b-2f3d-34c63c8151ab","type":"/#Logic/GetAllThienTai","parameters":{},"ports":[],"children":[]},{"id":"dfe14de7-e120-a1e7-fcf6-8d3899d28355","type":"JavaScriptFunction","parameters":{"functionScript":"Outputs.Dang = 2"},"ports":[{"name":"out-Dang","displayName":"Dang","plug":"output","type":"*","group":"Outputs","index":4}],"children":[]},{"id":"54d1d9fc-e632-c3cd-b037-95b40a72d3cd","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"43496db8-1aab-b4c8-0a77-4fd8f20d2637","type":"Component Outputs","parameters":{},"ports":[],"children":[]}],"connections":[{"sourceId":"dfe14de7-e120-a1e7-fcf6-8d3899d28355","sourcePort":"out-Dang","targetId":"3275d10f-e354-106b-2f3d-34c63c8151ab","targetPort":"status"},{"sourceId":"3275d10f-e354-106b-2f3d-34c63c8151ab","sourcePort":"Data","targetId":"ad6e8f2d-d19d-4bde-4b9e-a307a3769a36","targetPort":"in-data"},{"sourceId":"3275d10f-e354-106b-2f3d-34c63c8151ab","sourcePort":"Success","targetId":"ad6e8f2d-d19d-4bde-4b9e-a307a3769a36","targetPort":"run"},{"sourceId":"54d1d9fc-e632-c3cd-b037-95b40a72d3cd","sourcePort":"Do","targetId":"3275d10f-e354-106b-2f3d-34c63c8151ab","targetPort":"Do"},{"sourceId":"ad6e8f2d-d19d-4bde-4b9e-a307a3769a36","sourcePort":"out-Success","targetId":"43496db8-1aab-b4c8-0a77-4fd8f20d2637","targetPort":"Success"}],"ports":[{"name":"Success","type":"*","plug":"output","index":1},{"name":"Do","type":{"name":"signal","allowConnectionsOnly":true},"group":"Actions","plug":"input","index":1},{"name":"idThienTai","type":"*","plug":"input","index":2}],"roots":[]}]