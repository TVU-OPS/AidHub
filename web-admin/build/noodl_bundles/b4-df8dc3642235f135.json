[{"name":"/#Logic/GetAllYeuCau","nodes":[{"id":"cfa4cc14-36db-2ec3-13e9-61ab09b4521e","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"be249d19-2f63-430b-9474-a20b6625bf5d","type":"Component Outputs","parameters":{},"ports":[],"children":[]},{"id":"db3940f3-873f-b5c8-869e-ec22e245cec0","type":"JavaScriptFunction","parameters":{"functionScript":"let page = Inputs.page + 1 || 1;\r\nconst pageSize = Inputs.pageSize || 5;\r\nconst base_url = Inputs.base_url;\r\n\r\nconst keyword = Inputs.keyword;\r\nconst sort = Inputs.sort || \"desc\";\r\nconst ProvinceId = Inputs.ProvinceId;\r\nconst DistrictId = Inputs.DistrictId;\r\nconst WardId = Inputs.WardId;\r\nconst DisasterId = Inputs.DisasterId;\r\nconst status = Inputs.status;\r\n\r\n\r\nlet apiUrl = `${base_url}?populate=*&pagination[page]=${page}&pagination[pageSize]=${pageSize}&sort=createdAt:${sort}`;\r\n\r\nfunction createFilters(keyword) {\r\n  if (!keyword || typeof keyword !== \"string\") {\r\n    return;\r\n  }\r\n\r\n  const filters = [\r\n    `filters[$or][1][FullName][$contains]=${keyword}`,\r\n    `filters[$or][2][Email][$contains]=${keyword}`,\r\n    `filters[$or][3][RequestDescription][$contains]=${keyword}`,\r\n    `filters[$or][4][PhoneNumber][$contains]=${keyword}`,\r\n    `filters[$or][5][PhoneNumber][$contains]=${keyword}`,\r\n    `filters[$or][6][Province][ProvinceName][$contains]=${keyword}`,\r\n    `filters[$or][8][District][DistrictName][$contains]=${keyword}`,\r\n    `filters[$or][9][Ward][WardName][$contains]=${keyword}`,\r\n  ];\r\n\r\n  return filters.join(\"&\");\r\n}\r\n\r\nconst apiEndpoint = keyword ? createFilters(keyword) : \"\";\r\n\r\nif (DisasterId) {\r\n  if (DisasterId == \"-1\") {\r\n    apiUrl = apiUrl;\r\n  } else {\r\n    apiUrl += `&filters[Disaster]=${DisasterId}`;\r\n  }\r\n}\r\n\r\nif (ProvinceId) {\r\n  apiUrl += `&filters[Province]=${ProvinceId}`;\r\n}\r\n\r\nif (DistrictId) {\r\n  apiUrl += `&filters[District]=${DistrictId}`;\r\n}\r\n\r\nif (WardId) {\r\n  apiUrl += `&filters[Ward]=${WardId}`;\r\n}\r\n\r\nif (status) {\r\n  let filters = [];\r\n  // Chưa hổ trợ\r\n  if (status == '1') {\r\n    filters = [\r\n      `filters[AcceptedBy][$null]=true`\r\n    ];\r\n  } else if (status == '2') { //Đang hổ trợ\r\n    filters = [\r\n      `filters[$or][1][State]=false`,\r\n      `filters[$or][2][State][$null]=true`,\r\n      `filters[AcceptedBy][$notNull]=true`\r\n    ];\r\n  } else if (status == '3') {  // Đã hổ trợ\r\n    filters = [\r\n      `filters[$or][1][State]=true`\r\n    ];\r\n  }\r\n\r\n  apiUrl += `&${filters.join(\"&\")}`;\r\n}\r\n\r\nif (apiEndpoint) {\r\n  apiUrl += `&${apiEndpoint}`;\r\n}\r\n\r\nOutputs.api = apiUrl;\r\n"},"ports":[{"name":"in-page","displayName":"page","plug":"input","type":"*","group":"Inputs","index":4},{"name":"in-pageSize","displayName":"pageSize","plug":"input","type":"*","group":"Inputs","index":5},{"name":"in-base_url","displayName":"base_url","plug":"input","type":"*","group":"Inputs","index":6},{"name":"in-keyword","displayName":"keyword","plug":"input","type":"*","group":"Inputs","index":7},{"name":"in-sort","displayName":"sort","plug":"input","type":"*","group":"Inputs","index":8},{"name":"in-ProvinceId","displayName":"ProvinceId","plug":"input","type":"*","group":"Inputs","index":9},{"name":"in-DistrictId","displayName":"DistrictId","plug":"input","type":"*","group":"Inputs","index":10},{"name":"in-WardId","displayName":"WardId","plug":"input","type":"*","group":"Inputs","index":11},{"name":"in-DisasterId","displayName":"DisasterId","plug":"input","type":"*","group":"Inputs","index":12},{"name":"in-status","displayName":"status","plug":"input","type":"*","group":"Inputs","index":13},{"name":"out-api","displayName":"api","plug":"output","type":"*","group":"Outputs","index":14}],"children":[]},{"id":"f1b9b6dc-1a1f-ca71-233f-1dc447643233","type":"REST2","parameters":{"responseScript":"// Add custom code to convert the response content to outputs\n//\n//*Response.status    The status code of the response\n//*Response.content   The content of the response as a javascript\n//                    object.\n//*Response.request   The request object that resulted in the response.\n//\n//*Inputs and *Outputs contain the inputs and outputs of the node.\n\nconst DATA = Response.content;\n\nif (!DATA) return;\n\nOutputs.Pagination = Response.content?.meta?.pagination\nOutputs.DATA = Response.content?.data\nOutputs.Results = DATA;","resource":"","requestScript":"//Add custom code to setup the request object before the request\n//is made.\n//\n//*Request.resource     contains the resource path of the request.\n//*Request.method       contains the method, GET, POST, PUT or DELETE.\n//*Request.headers      is a map where you can add additional headers.\n//*Request.parameters   is a map the parameters that will be appended\n//                      to the url.\n//*Request.content      contains the content of the request as a javascript\n//                      object.\n//\nconst tokenInfo = Inputs.token\n\nRequest.headers = {\n    Authorization: `Bearer ${tokenInfo}`,\n}"},"ports":[],"children":[]},{"id":"1edae456-f7e7-c2ec-bb7a-270175620596","type":"/#Logic/State API","parameters":{},"ports":[],"children":[]},{"id":"7ef0cc7d-6d4e-b99f-ba89-dc5ee6f0e176","type":"/#Logic/CurrentUser","parameters":{},"ports":[],"children":[]},{"id":"5ccd718c-87db-f9e8-1a2f-4a5106e4214d","type":"/#Logic/Get paganation","parameters":{},"ports":[],"children":[]},{"id":"3151bebd-54eb-7c37-cc72-c50b2753f908","type":"/Loading Spinner","parameters":{},"ports":[],"children":[]}],"connections":[{"sourceId":"db3940f3-873f-b5c8-869e-ec22e245cec0","sourcePort":"out-api","targetId":"f1b9b6dc-1a1f-ca71-233f-1dc447643233","targetPort":"resource"},{"sourceId":"cfa4cc14-36db-2ec3-13e9-61ab09b4521e","sourcePort":"sort","targetId":"db3940f3-873f-b5c8-869e-ec22e245cec0","targetPort":"in-sort"},{"sourceId":"cfa4cc14-36db-2ec3-13e9-61ab09b4521e","sourcePort":"status","targetId":"db3940f3-873f-b5c8-869e-ec22e245cec0","targetPort":"in-status"},{"sourceId":"cfa4cc14-36db-2ec3-13e9-61ab09b4521e","sourcePort":"DisasterId","targetId":"db3940f3-873f-b5c8-869e-ec22e245cec0","targetPort":"in-DisasterId"},{"sourceId":"cfa4cc14-36db-2ec3-13e9-61ab09b4521e","sourcePort":"ProvinceId ","targetId":"db3940f3-873f-b5c8-869e-ec22e245cec0","targetPort":"in-ProvinceId"},{"sourceId":"cfa4cc14-36db-2ec3-13e9-61ab09b4521e","sourcePort":"WardId","targetId":"db3940f3-873f-b5c8-869e-ec22e245cec0","targetPort":"in-WardId"},{"sourceId":"cfa4cc14-36db-2ec3-13e9-61ab09b4521e","sourcePort":"keyword","targetId":"db3940f3-873f-b5c8-869e-ec22e245cec0","targetPort":"in-keyword"},{"sourceId":"1edae456-f7e7-c2ec-bb7a-270175620596","sourcePort":"get_sos","targetId":"db3940f3-873f-b5c8-869e-ec22e245cec0","targetPort":"in-base_url"},{"sourceId":"7ef0cc7d-6d4e-b99f-ba89-dc5ee6f0e176","sourcePort":"token","targetId":"f1b9b6dc-1a1f-ca71-233f-1dc447643233","targetPort":"in-token"},{"sourceId":"f1b9b6dc-1a1f-ca71-233f-1dc447643233","sourcePort":"out-DATA","targetId":"be249d19-2f63-430b-9474-a20b6625bf5d","targetPort":"Data"},{"sourceId":"f1b9b6dc-1a1f-ca71-233f-1dc447643233","sourcePort":"out-Pagination","targetId":"5ccd718c-87db-f9e8-1a2f-4a5106e4214d","targetPort":"Pagination"},{"sourceId":"5ccd718c-87db-f9e8-1a2f-4a5106e4214d","sourcePort":"pageSize","targetId":"be249d19-2f63-430b-9474-a20b6625bf5d","targetPort":"PageSize"},{"sourceId":"5ccd718c-87db-f9e8-1a2f-4a5106e4214d","sourcePort":"total","targetId":"be249d19-2f63-430b-9474-a20b6625bf5d","targetPort":"total"},{"sourceId":"5ccd718c-87db-f9e8-1a2f-4a5106e4214d","sourcePort":"page","targetId":"be249d19-2f63-430b-9474-a20b6625bf5d","targetPort":"Page"},{"sourceId":"cfa4cc14-36db-2ec3-13e9-61ab09b4521e","sourcePort":"Do","targetId":"f1b9b6dc-1a1f-ca71-233f-1dc447643233","targetPort":"fetch"},{"sourceId":"cfa4cc14-36db-2ec3-13e9-61ab09b4521e","sourcePort":"DistrictId","targetId":"db3940f3-873f-b5c8-869e-ec22e245cec0","targetPort":"in-DistrictId"},{"sourceId":"cfa4cc14-36db-2ec3-13e9-61ab09b4521e","sourcePort":"page","targetId":"db3940f3-873f-b5c8-869e-ec22e245cec0","targetPort":"in-page"},{"sourceId":"cfa4cc14-36db-2ec3-13e9-61ab09b4521e","sourcePort":"limit","targetId":"db3940f3-873f-b5c8-869e-ec22e245cec0","targetPort":"in-pageSize"},{"sourceId":"f1b9b6dc-1a1f-ca71-233f-1dc447643233","sourcePort":"success","targetId":"be249d19-2f63-430b-9474-a20b6625bf5d","targetPort":"Success"},{"sourceId":"f1b9b6dc-1a1f-ca71-233f-1dc447643233","sourcePort":"failure","targetId":"be249d19-2f63-430b-9474-a20b6625bf5d","targetPort":"Failure"},{"sourceId":"cfa4cc14-36db-2ec3-13e9-61ab09b4521e","sourcePort":"Do","targetId":"3151bebd-54eb-7c37-cc72-c50b2753f908","targetPort":"Show"},{"sourceId":"f1b9b6dc-1a1f-ca71-233f-1dc447643233","sourcePort":"failure","targetId":"3151bebd-54eb-7c37-cc72-c50b2753f908","targetPort":"Hide"},{"sourceId":"f1b9b6dc-1a1f-ca71-233f-1dc447643233","sourcePort":"success","targetId":"3151bebd-54eb-7c37-cc72-c50b2753f908","targetPort":"Hide"},{"sourceId":"f1b9b6dc-1a1f-ca71-233f-1dc447643233","sourcePort":"out-DATA","targetId":"3151bebd-54eb-7c37-cc72-c50b2753f908","targetPort":"Hide"},{"sourceId":"f1b9b6dc-1a1f-ca71-233f-1dc447643233","sourcePort":"canceled","targetId":"3151bebd-54eb-7c37-cc72-c50b2753f908","targetPort":"Hide"}],"ports":[{"name":"Success","type":"signal","plug":"output","index":0},{"name":"Do","type":{"name":"signal","allowConnectionsOnly":true},"group":"Actions","plug":"input","index":0},{"name":"Failure","type":"signal","plug":"output","index":1},{"name":"sort","type":"*","group":"Inputs","plug":"input","index":1},{"name":"Data","type":"*","plug":"output","index":2},{"name":"status","type":"*","group":"Inputs","plug":"input","index":2},{"name":"Page","type":"*","plug":"output","index":3},{"name":"DisasterId","type":"*","group":"Inputs","plug":"input","index":3},{"name":"PageSize","type":"*","plug":"output","index":4},{"name":"ProvinceId ","type":"*","group":"Inputs","plug":"input","index":4},{"name":"total","type":"*","plug":"output","index":5},{"name":"DistrictId","type":"*","group":"Inputs","plug":"input","index":5},{"name":"WardId","type":"*","group":"Inputs","plug":"input","index":6},{"name":"keyword","type":"*","group":"Inputs","plug":"input","index":7},{"name":"page","type":"*","group":"Inputs","plug":"input","index":8},{"name":"limit","type":"*","group":"Inputs","plug":"input","index":9}],"roots":[]}]