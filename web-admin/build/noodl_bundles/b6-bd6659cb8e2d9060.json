[{"name":"/#Logic/GetAllThienTai","nodes":[{"id":"cec4cac0-ddd0-885a-c976-a4da07980422","type":"REST2","parameters":{"responseScript":"// Add custom code to convert the response content to outputs\n//\n//*Response.status    The status code of the response\n//*Response.content   The content of the response as a javascript\n//                    object.\n//*Response.request   The request object that resulted in the response.\n//\n//*Inputs and *Outputs contain the inputs and outputs of the node.\n\nconst DATA = Response.content;\n\nif(!DATA) return;\n\nOutputs.Pagination = Response.content?.meta?.pagination\nOutputs.DATA = Response.content?.data\nOutputs.Results = Response.DATA;"},"ports":[],"children":[]},{"id":"7c7400be-750c-b948-3531-3d12c0482390","type":"/#Logic/Get paganation","parameters":{},"ports":[],"children":[]},{"id":"e6959d93-30e5-7674-1d28-cafc999427e6","type":"/#Logic/State API","parameters":{},"ports":[],"children":[]},{"id":"ff5da401-f84f-db14-23fc-30074797cf3d","type":"JavaScriptFunction","parameters":{"functionScript":"const page = Inputs.page + 1 || 1;\r\nconst pageSize = Inputs.pageSize || 5;\r\nconst base_url = Inputs.base_url;\r\n\r\nconst keyword = Inputs.keyword;\r\nconst sort = Inputs.sort || \"desc\";\r\nconst status = Inputs.status;\r\nconst type = Inputs.type\r\nconst provinces = Inputs.provinces\r\n\r\nfunction createFilters(keyword) {\r\n  if (!keyword || typeof keyword !== \"string\") {\r\n    throw new Error(\"Keyword không hợp lệ!\");\r\n  }\r\n\r\n  const filters = [\r\n    `filters[$or][0][Name][$contains]=${keyword}`, // Tìm theo trường Name\r\n    `filters[$or][1][Description][$contains]=${keyword}`, // Tìm trong User.username\r\n    `filters[$or][2][DisasterType][DisasterTypeName][$contains]=${keyword}`, // Tìm trong User.username\r\n  ];\r\n\r\n  return `${filters.join(\"&\")}`;\r\n}\r\n\r\nlet api = `${base_url}?populate=*&pagination[page]=${page}&pagination[pageSize]=${pageSize}&sort=createdAt:${sort}`;\r\n\r\nif (keyword) {\r\n  const apiEndpoint = keyword && createFilters(keyword);\r\n  api += `&${apiEndpoint}`;\r\n}\r\n\r\nif (status) {\r\n  let filters = [];\r\n  // Chưa diễn ra\r\n  if (status == \"1\") {\r\n    filters = [`filters[StartDate][$gt]=${new Date().toISOString()}`];\r\n  }\r\n\r\n  // Đang diễn ra\r\n  if (status == \"2\") {\r\n    filters = [\r\n      `filters[StartDate][$lte]=${new Date().toISOString()}`,\r\n      `filters[$or][0][EndDate][$null]=true`,\r\n      `filters[$or][1][EndDate][$gte]=${new Date().toISOString()}`,\r\n    ];\r\n  }\r\n\r\n  // Đã diễn ra\r\n  if (status == \"3\") {\r\n    filters= [\r\n        `filters[EndDate][$lt]=${new Date().toISOString()}`\r\n    ]\r\n  }\r\n\r\n  api += `&${filters.join(\"&\")}`;\r\n}\r\n\r\nif(provinces){\r\n  api += `&filters[Provinces]=${provinces}`\r\n}\r\n\r\n\r\nif(type){\r\n  api += `&filters[DisasterType]=${type}`\r\n}\r\n\r\n\r\nOutputs.api = api;\r\n"},"ports":[{"name":"in-page","displayName":"page","plug":"input","type":"*","group":"Inputs","index":4},{"name":"in-pageSize","displayName":"pageSize","plug":"input","type":"*","group":"Inputs","index":5},{"name":"in-base_url","displayName":"base_url","plug":"input","type":"*","group":"Inputs","index":6},{"name":"in-keyword","displayName":"keyword","plug":"input","type":"*","group":"Inputs","index":7},{"name":"in-sort","displayName":"sort","plug":"input","type":"*","group":"Inputs","index":8},{"name":"in-status","displayName":"status","plug":"input","type":"*","group":"Inputs","index":9},{"name":"in-type","displayName":"type","plug":"input","type":"*","group":"Inputs","index":10},{"name":"in-provinces","displayName":"provinces","plug":"input","type":"*","group":"Inputs","index":11},{"name":"out-api","displayName":"api","plug":"output","type":"*","group":"Outputs","index":12}],"children":[]},{"id":"947068b9-5567-2019-0804-cad089ff623b","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"1da5008d-6204-4fdc-f4ab-6cb4edb12734","type":"Component Outputs","parameters":{},"ports":[],"children":[]}],"connections":[{"sourceId":"cec4cac0-ddd0-885a-c976-a4da07980422","sourcePort":"out-Pagination","targetId":"7c7400be-750c-b948-3531-3d12c0482390","targetPort":"Pagination"},{"sourceId":"e6959d93-30e5-7674-1d28-cafc999427e6","sourcePort":"disasters","targetId":"ff5da401-f84f-db14-23fc-30074797cf3d","targetPort":"in-base_url"},{"sourceId":"ff5da401-f84f-db14-23fc-30074797cf3d","sourcePort":"out-api","targetId":"cec4cac0-ddd0-885a-c976-a4da07980422","targetPort":"resource"},{"sourceId":"947068b9-5567-2019-0804-cad089ff623b","sourcePort":"page","targetId":"ff5da401-f84f-db14-23fc-30074797cf3d","targetPort":"in-page"},{"sourceId":"947068b9-5567-2019-0804-cad089ff623b","sourcePort":"limit","targetId":"ff5da401-f84f-db14-23fc-30074797cf3d","targetPort":"in-pageSize"},{"sourceId":"947068b9-5567-2019-0804-cad089ff623b","sourcePort":"keyword","targetId":"ff5da401-f84f-db14-23fc-30074797cf3d","targetPort":"in-keyword"},{"sourceId":"947068b9-5567-2019-0804-cad089ff623b","sourcePort":"sort","targetId":"ff5da401-f84f-db14-23fc-30074797cf3d","targetPort":"in-sort"},{"sourceId":"947068b9-5567-2019-0804-cad089ff623b","sourcePort":"status","targetId":"ff5da401-f84f-db14-23fc-30074797cf3d","targetPort":"in-status"},{"sourceId":"947068b9-5567-2019-0804-cad089ff623b","sourcePort":"ProvinceId","targetId":"ff5da401-f84f-db14-23fc-30074797cf3d","targetPort":"in-provinces"},{"sourceId":"cec4cac0-ddd0-885a-c976-a4da07980422","sourcePort":"out-DATA","targetId":"1da5008d-6204-4fdc-f4ab-6cb4edb12734","targetPort":"Data"},{"sourceId":"7c7400be-750c-b948-3531-3d12c0482390","sourcePort":"page","targetId":"1da5008d-6204-4fdc-f4ab-6cb4edb12734","targetPort":"Page"},{"sourceId":"7c7400be-750c-b948-3531-3d12c0482390","sourcePort":"pageSize","targetId":"1da5008d-6204-4fdc-f4ab-6cb4edb12734","targetPort":"PageSize"},{"sourceId":"7c7400be-750c-b948-3531-3d12c0482390","sourcePort":"total","targetId":"1da5008d-6204-4fdc-f4ab-6cb4edb12734","targetPort":"total"},{"sourceId":"cec4cac0-ddd0-885a-c976-a4da07980422","sourcePort":"success","targetId":"1da5008d-6204-4fdc-f4ab-6cb4edb12734","targetPort":"Success"},{"sourceId":"cec4cac0-ddd0-885a-c976-a4da07980422","sourcePort":"failure","targetId":"1da5008d-6204-4fdc-f4ab-6cb4edb12734","targetPort":"Failure"},{"sourceId":"947068b9-5567-2019-0804-cad089ff623b","sourcePort":"Do","targetId":"cec4cac0-ddd0-885a-c976-a4da07980422","targetPort":"fetch"},{"sourceId":"947068b9-5567-2019-0804-cad089ff623b","sourcePort":"type","targetId":"ff5da401-f84f-db14-23fc-30074797cf3d","targetPort":"in-type"}],"ports":[{"name":"Success","type":"signal","plug":"output","index":0},{"name":"Failure","type":"signal","plug":"output","index":1},{"name":"sort","type":"*","group":"Inputs","plug":"input","index":1},{"name":"Data","type":"*","plug":"output","index":2},{"name":"status","type":"*","group":"Inputs","plug":"input","index":2},{"name":"Page","type":"*","plug":"output","index":3},{"name":"ProvinceId","type":"*","group":"Inputs","plug":"input","index":3},{"name":"PageSize","type":"*","plug":"output","index":4},{"name":"keyword","type":"*","group":"Inputs","plug":"input","index":4},{"name":"total","type":"*","plug":"output","index":5},{"name":"Do","type":{"name":"signal","allowConnectionsOnly":true},"group":"Actions","plug":"input","index":5},{"name":"page","type":"*","group":"Inputs","plug":"input","index":6},{"name":"limit","type":"*","group":"Inputs","plug":"input","index":7},{"name":"Clear","type":"*","plug":"input","index":8},{"name":"type","type":"*","group":"Inputs","plug":"input","index":9}],"roots":[]}]