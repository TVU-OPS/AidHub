[{"name":"/page/map","nodes":[{"id":"d14e2cc3-2d5d-ce1c-f659-12b0e2db3718","type":"Page","parameters":{},"ports":[],"children":[{"id":"8267f8e8-fa95-51ff-1370-c473911ade59","type":"Group","parameters":{"scrollEnabled":true,"paddingLeft":{"value":60,"unit":"px"},"paddingRight":{"value":60,"unit":"px"},"rowGap":{"value":8,"unit":"px"},"height":{"value":100,"unit":"vh","isFixed":false}},"ports":[],"children":[{"id":"18c0015a-a67e-cfa1-45f2-703918377868","type":"Group","parameters":{"minWidth":{"value":100,"unit":"%"},"minHeight":{"value":80,"unit":"px"},"backgroundColor":"transparent","maxHeight":{"value":80,"unit":"px"},"flexDirection":"row","alignItems":"center","paddingLeft":{"value":12,"unit":"px"},"paddingRight":{"value":12,"unit":"px"},"paddingTop":{"value":12,"unit":"px"},"paddingBottom":{"value":12,"unit":"px"},"columnGap":{"value":12,"unit":"px"},"position":"relative"},"ports":[],"children":[{"id":"b0a7f89d-4500-b1f0-acb8-476dda693d95","type":"net.noodl.controls.options","parameters":{"maxWidth":{"value":200,"unit":"px"},"label":"ThiÃªn tai","items":"[\n]"},"ports":[],"children":[]}]},{"id":"21b366ab-d5da-f08c-eb36-011fa7832855","type":"Group","parameters":{"paddingLeft":{"value":12,"unit":"px"},"paddingRight":{"value":12,"unit":"px"},"paddingTop":{"value":12,"unit":"px"},"paddingBottom":{"value":12,"unit":"px"},"backgroundColor":"Border","sizeMode":"explicit","borderRadius":{"value":12,"unit":"px"}},"ports":[],"children":[{"id":"eb318fbe-ba9e-866c-954f-f90155cfb9d2","type":"Group","parameters":{"backgroundColor":"#999"},"ports":[],"children":[{"id":"ab859bab-7910-6d5f-cf29-e0fbd33b01dc","type":"/component/MapboxYeuCau","parameters":{},"ports":[],"children":[]}]}]}]}]},{"id":"85b87ce8-96e5-1450-39e7-5753c4482053","type":"REST2","parameters":{"resource":"","responseScript":"// Add custom code to convert the response content to outputs\n//\n//*Response.status    The status code of the response\n//*Response.content   The content of the response as a javascript\n//                    object.\n//*Response.request   The request object that resulted in the response.\n//\n//*Inputs and *Outputs contain the inputs and outputs of the node.\nconst data = Response.content;\n\nif(!data) return;\n\nOutputs.data = Response.content?.data\nOutputs.Results = Response.content;"},"ports":[],"children":[]},{"id":"0cf8f9a9-5e74-88d3-a4a1-2907fe49c470","type":"/#Logic/State API","parameters":{},"ports":[],"children":[]},{"id":"30a2a11d-277d-1e70-b8a4-be9719e58c83","type":"JavaScriptFunction","parameters":{"functionScript":"\r\nconst allData = Inputs.allData;\r\n\r\nif (!allData || !allData.length) return;\r\n\r\nconst dropdownValues = allData.map(item => (\r\n    {\r\n        Label: item.Name,\r\n        Value: String(item.documentId)\r\n    }\r\n))\r\n\r\nOutputs.dropdownValues = dropdownValues;"},"ports":[{"name":"in-allData","displayName":"allData","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-dropdownValues","displayName":"dropdownValues","plug":"output","type":"*","group":"Outputs","index":5}],"children":[]},{"id":"6ef2cf40-428c-c859-a930-677432d429d0","type":"/#Logic/UpdateViTriYeuCau","parameters":{},"ports":[],"children":[]},{"id":"bcdfe1e1-78d7-b3ac-da4e-1fb17d737d97","type":"PageInputs","parameters":{"pathParams":"idThienTai"},"ports":[],"children":[]},{"id":"3618bfa8-b06a-78b3-766a-7562c690e002","type":"RouterNavigate","parameters":{"router":"Main","target":"/page/map"},"ports":[],"children":[]}],"connections":[{"sourceId":"0cf8f9a9-5e74-88d3-a4a1-2907fe49c470","sourcePort":"disasters","targetId":"85b87ce8-96e5-1450-39e7-5753c4482053","targetPort":"resource"},{"sourceId":"d14e2cc3-2d5d-ce1c-f659-12b0e2db3718","sourcePort":"didMount","targetId":"85b87ce8-96e5-1450-39e7-5753c4482053","targetPort":"fetch"},{"sourceId":"85b87ce8-96e5-1450-39e7-5753c4482053","sourcePort":"out-data","targetId":"30a2a11d-277d-1e70-b8a4-be9719e58c83","targetPort":"in-allData"},{"sourceId":"85b87ce8-96e5-1450-39e7-5753c4482053","sourcePort":"out-data","targetId":"30a2a11d-277d-1e70-b8a4-be9719e58c83","targetPort":"run"},{"sourceId":"30a2a11d-277d-1e70-b8a4-be9719e58c83","sourcePort":"out-dropdownValues","targetId":"b0a7f89d-4500-b1f0-acb8-476dda693d95","targetPort":"items"},{"sourceId":"d14e2cc3-2d5d-ce1c-f659-12b0e2db3718","sourcePort":"didMount","targetId":"6ef2cf40-428c-c859-a930-677432d429d0","targetPort":"Do"},{"sourceId":"bcdfe1e1-78d7-b3ac-da4e-1fb17d737d97","sourcePort":"pm-idThienTai","targetId":"6ef2cf40-428c-c859-a930-677432d429d0","targetPort":"idThienTai"},{"sourceId":"b0a7f89d-4500-b1f0-acb8-476dda693d95","sourcePort":"onChange","targetId":"3618bfa8-b06a-78b3-766a-7562c690e002","targetPort":"navigate"},{"sourceId":"b0a7f89d-4500-b1f0-acb8-476dda693d95","sourcePort":"value","targetId":"3618bfa8-b06a-78b3-766a-7562c690e002","targetPort":"pm-idThienTai"}],"ports":[],"roots":["d14e2cc3-2d5d-ce1c-f659-12b0e2db3718"]},{"name":"/#Logic/UpdateViTriYeuCau","nodes":[{"id":"31602c0b-e2ad-5357-1a88-0b22119c25aa","type":"JavaScriptFunction","parameters":{"functionScript":"const data = Inputs.data;\r\n\r\nfunction extractProvinces(data) {\r\n  return data?.Provinces?.map(province => ({\r\n    name: province.FullName,\r\n    location: {\r\n      lat: parseFloat(province.Latitude) || 0,\r\n      lng: parseFloat(province.Longitude) || 0,\r\n    },\r\n  }))\r\n}\r\n\r\nif (data) {\r\n  const provinces = extractProvinces(data);\r\n\r\n  Outputs.idThienTai = data.id\r\n\r\n  const oldProvinces = JSON.parse(localStorage.getItem(\"provinces\")) || [];\r\n\r\n  if (JSON.stringify(provinces) === JSON.stringify(oldProvinces)) {\r\n    return;\r\n  } else {\r\n    if (provinces !== undefined) {\r\n      localStorage.setItem(\"provinces\", JSON.stringify(provinces));\r\n      Outputs.Success();\r\n      return;\r\n    }\r\n  }\r\n}"},"ports":[{"name":"in-data","displayName":"data","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":5},{"name":"out-idThienTai","displayName":"idThienTai","plug":"output","type":"*","group":"Outputs","index":6}],"children":[]},{"id":"7aa0b85b-bf3c-be4b-f6cf-adc15eec033e","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"3260cc45-9fc4-f231-9b0f-3790bc270ff6","type":"/#Logic/ReloadPage","parameters":{},"ports":[],"children":[]},{"id":"1764540a-728f-7947-cbaf-28d46291ad88","type":"/#Logic/GetChiTietThienTai","parameters":{},"ports":[],"children":[]},{"id":"01a8342a-2ba1-2cc0-a1c3-ea8d22c9ae94","type":"/#Logic/GetAllYeuCau","parameters":{},"ports":[],"children":[]},{"id":"8fd506a7-22ee-78f6-06d8-dcd5b18ddbe8","type":"JavaScriptFunction","parameters":{"functionScript":"const data = Inputs.data;\r\n\r\nfunction extractProvinces(data) {\r\n  return data\r\n    .filter((item) => item.Location?.lat && item.Location?.lng)\r\n    .map((item) => ({\r\n      description: item.FullName,\r\n      phone: item.PhoneNumber,\r\n      lat: item.Location.lat ? parseFloat(item.Location.lat) : 0,\r\n      lng: item.Location.lat ? parseFloat(item.Location.lng) : 0,\r\n    }));\r\n}\r\n\r\nif (data) {\r\n  const locations = extractProvinces(data);\r\n\r\n  const oldLocations = JSON.parse(localStorage.getItem(\"locations\")) || [];\r\n\r\n  if (JSON.stringify(locations) === JSON.stringify(oldLocations)) {\r\n    return;\r\n  } else {\r\n    if (locations !== undefined) {\r\n      localStorage.setItem(\"locations\", JSON.stringify(locations));\r\n      Outputs.Success();\r\n      return;\r\n    }\r\n  }\r\n}\r\n"},"ports":[{"name":"in-data","displayName":"data","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":5}],"children":[]}],"connections":[{"sourceId":"31602c0b-e2ad-5357-1a88-0b22119c25aa","sourcePort":"out-Success","targetId":"3260cc45-9fc4-f231-9b0f-3790bc270ff6","targetPort":"Do"},{"sourceId":"7aa0b85b-bf3c-be4b-f6cf-adc15eec033e","sourcePort":"idThienTai","targetId":"1764540a-728f-7947-cbaf-28d46291ad88","targetPort":"id"},{"sourceId":"7aa0b85b-bf3c-be4b-f6cf-adc15eec033e","sourcePort":"Do","targetId":"1764540a-728f-7947-cbaf-28d46291ad88","targetPort":"Do"},{"sourceId":"1764540a-728f-7947-cbaf-28d46291ad88","sourcePort":"data","targetId":"31602c0b-e2ad-5357-1a88-0b22119c25aa","targetPort":"in-data"},{"sourceId":"31602c0b-e2ad-5357-1a88-0b22119c25aa","sourcePort":"out-idThienTai","targetId":"01a8342a-2ba1-2cc0-a1c3-ea8d22c9ae94","targetPort":"DisasterId"},{"sourceId":"31602c0b-e2ad-5357-1a88-0b22119c25aa","sourcePort":"out-idThienTai","targetId":"01a8342a-2ba1-2cc0-a1c3-ea8d22c9ae94","targetPort":"Do"},{"sourceId":"01a8342a-2ba1-2cc0-a1c3-ea8d22c9ae94","sourcePort":"Data","targetId":"8fd506a7-22ee-78f6-06d8-dcd5b18ddbe8","targetPort":"in-data"},{"sourceId":"01a8342a-2ba1-2cc0-a1c3-ea8d22c9ae94","sourcePort":"Data","targetId":"8fd506a7-22ee-78f6-06d8-dcd5b18ddbe8","targetPort":"run"},{"sourceId":"8fd506a7-22ee-78f6-06d8-dcd5b18ddbe8","sourcePort":"out-Success","targetId":"3260cc45-9fc4-f231-9b0f-3790bc270ff6","targetPort":"Do"}],"ports":[{"name":"Do","type":{"name":"signal","allowConnectionsOnly":true},"group":"Actions","plug":"input","index":1},{"name":"idThienTai","type":{"name":"*","editAsType":"string"},"group":"Parameters","plug":"input","index":2}],"roots":[]}]