[{"name":"/#Logic/GetAllToChuc","nodes":[{"id":"053e31f8-6ae9-e9b5-9f1c-b3a8b74681f5","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"95e4ffa4-443d-c3b0-346f-d381ada9e966","type":"/#Logic/State API","parameters":{},"ports":[],"children":[]},{"id":"2b6b3bb6-b45a-43ee-896e-1c51ff46f3c5","type":"REST2","parameters":{"resource":"","responseScript":"// Add custom code to convert the response content to outputs\n//\n//*Response.status    The status code of the response\n//*Response.content   The content of the response as a javascript\n//                    object.\n//*Response.request   The request object that resulted in the response.\n//\n//*Inputs and *Outputs contain the inputs and outputs of the node.\n\nconst DATA = Response.content;\n\nif(!DATA) return;\n\nOutputs.Pagination = Response.content?.meta?.pagination\nOutputs.DATA = Response.content?.data\nOutputs.Results = Response.DATA;"},"ports":[],"children":[]},{"id":"5302872b-8efa-51bc-7c53-69e1442ecd52","type":"JavaScriptFunction","parameters":{"functionScript":"const page = Inputs.page + 1 || 1\r\nconst pageSize = Inputs.pageSize || 5\r\nconst base_url = Inputs.base_url\r\n\r\nconst keyword = Inputs.keyword\r\nconst sort = Inputs.sort || 'desc'\r\nconst confirmed = Inputs.confirmed\r\nconst idTinh = Inputs.idTinh\r\n\r\n\r\nlet api = base_url + `?populate=*&pagination[page]=${page}&pagination[pageSize]=${pageSize}&filters[user][$notNull]=true&sort=createdAt:${sort}`\r\n\r\n\r\nfunction createFilters(keyword) {\r\n    if (!keyword || typeof keyword !== \"string\") {\r\n        throw new Error(\"Keyword không hợp lệ!\");\r\n    }\r\n\r\n    const filters = [\r\n        `filters[$or][0][Name][$contains]=${keyword}`, // Tìm theo trường Name\r\n        `filters[$or][1][user][username][$contains]=${keyword}`, // Tìm trong User.username\r\n        `filters[$or][2][user][email][$contains]=${keyword}` // Tìm trong User.email\r\n    ];\r\n\r\n    return `${filters.join(\"&\")}`;\r\n}\r\n\r\n\r\nif (keyword) {\r\n    const apiEndpoint = createFilters(keyword);\r\n    api += `&${apiEndpoint}`;\r\n}\r\n\r\nif (idTinh) {\r\n    api += `&filters[Province]=${idTinh}`;\r\n}\r\n\r\n\r\nif (confirmed) {\r\n    const tam = confirmed === 'true' ? true : false\r\n    if (tam == true) {\r\n        api += `&filters[Confirmed]=true`;\r\n    } else {\r\n        api += `&filters[$or][0][Confirmed]=false&filters[$or][1][Confirmed][$null]=true`;\r\n    }\r\n}\r\n\r\nOutputs.api = api\r\n"},"ports":[{"name":"in-page","displayName":"page","plug":"input","type":"*","group":"Inputs","index":4},{"name":"in-pageSize","displayName":"pageSize","plug":"input","type":"*","group":"Inputs","index":5},{"name":"in-base_url","displayName":"base_url","plug":"input","type":"*","group":"Inputs","index":6},{"name":"in-keyword","displayName":"keyword","plug":"input","type":"*","group":"Inputs","index":7},{"name":"in-sort","displayName":"sort","plug":"input","type":"*","group":"Inputs","index":8},{"name":"in-confirmed","displayName":"confirmed","plug":"input","type":"*","group":"Inputs","index":9},{"name":"in-idTinh","displayName":"idTinh","plug":"input","type":"*","group":"Inputs","index":10},{"name":"out-api","displayName":"api","plug":"output","type":"*","group":"Outputs","index":11}],"children":[]},{"id":"1cc8b995-767d-38a4-9097-895d7d1b2b0d","type":"/#Logic/Get paganation","parameters":{},"ports":[],"children":[]},{"id":"41614692-f631-45ca-3d3a-ffd778df5c91","type":"Component Outputs","parameters":{},"ports":[],"children":[]},{"id":"e788d629-1180-088b-d828-1af18ebdab12","type":"/Loading Spinner","parameters":{},"ports":[],"children":[]}],"connections":[{"sourceId":"95e4ffa4-443d-c3b0-346f-d381ada9e966","sourcePort":"support_organizations","targetId":"5302872b-8efa-51bc-7c53-69e1442ecd52","targetPort":"in-base_url"},{"sourceId":"5302872b-8efa-51bc-7c53-69e1442ecd52","sourcePort":"out-api","targetId":"2b6b3bb6-b45a-43ee-896e-1c51ff46f3c5","targetPort":"resource"},{"sourceId":"2b6b3bb6-b45a-43ee-896e-1c51ff46f3c5","sourcePort":"out-Pagination","targetId":"1cc8b995-767d-38a4-9097-895d7d1b2b0d","targetPort":"Pagination"},{"sourceId":"053e31f8-6ae9-e9b5-9f1c-b3a8b74681f5","sourcePort":"sort","targetId":"5302872b-8efa-51bc-7c53-69e1442ecd52","targetPort":"in-sort"},{"sourceId":"053e31f8-6ae9-e9b5-9f1c-b3a8b74681f5","sourcePort":"status","targetId":"5302872b-8efa-51bc-7c53-69e1442ecd52","targetPort":"in-confirmed"},{"sourceId":"053e31f8-6ae9-e9b5-9f1c-b3a8b74681f5","sourcePort":"ProvinceId","targetId":"5302872b-8efa-51bc-7c53-69e1442ecd52","targetPort":"in-idTinh"},{"sourceId":"053e31f8-6ae9-e9b5-9f1c-b3a8b74681f5","sourcePort":"keyword","targetId":"5302872b-8efa-51bc-7c53-69e1442ecd52","targetPort":"in-keyword"},{"sourceId":"053e31f8-6ae9-e9b5-9f1c-b3a8b74681f5","sourcePort":"Do","targetId":"2b6b3bb6-b45a-43ee-896e-1c51ff46f3c5","targetPort":"fetch"},{"sourceId":"053e31f8-6ae9-e9b5-9f1c-b3a8b74681f5","sourcePort":"page","targetId":"5302872b-8efa-51bc-7c53-69e1442ecd52","targetPort":"in-page"},{"sourceId":"053e31f8-6ae9-e9b5-9f1c-b3a8b74681f5","sourcePort":"limit","targetId":"5302872b-8efa-51bc-7c53-69e1442ecd52","targetPort":"in-pageSize"},{"sourceId":"2b6b3bb6-b45a-43ee-896e-1c51ff46f3c5","sourcePort":"out-DATA","targetId":"41614692-f631-45ca-3d3a-ffd778df5c91","targetPort":"Data"},{"sourceId":"1cc8b995-767d-38a4-9097-895d7d1b2b0d","sourcePort":"page","targetId":"41614692-f631-45ca-3d3a-ffd778df5c91","targetPort":"Page"},{"sourceId":"1cc8b995-767d-38a4-9097-895d7d1b2b0d","sourcePort":"pageSize","targetId":"41614692-f631-45ca-3d3a-ffd778df5c91","targetPort":"PageSize"},{"sourceId":"1cc8b995-767d-38a4-9097-895d7d1b2b0d","sourcePort":"total","targetId":"41614692-f631-45ca-3d3a-ffd778df5c91","targetPort":"total"},{"sourceId":"053e31f8-6ae9-e9b5-9f1c-b3a8b74681f5","sourcePort":"Do","targetId":"e788d629-1180-088b-d828-1af18ebdab12","targetPort":"Show"},{"sourceId":"2b6b3bb6-b45a-43ee-896e-1c51ff46f3c5","sourcePort":"success","targetId":"e788d629-1180-088b-d828-1af18ebdab12","targetPort":"Hide"},{"sourceId":"2b6b3bb6-b45a-43ee-896e-1c51ff46f3c5","sourcePort":"failure","targetId":"e788d629-1180-088b-d828-1af18ebdab12","targetPort":"Hide"}],"ports":[{"name":"Success","type":"*","plug":"output","index":0},{"name":"Failure","type":"*","plug":"output","index":1},{"name":"sort","type":"*","group":"Inputs","plug":"input","index":1},{"name":"Data","type":"*","plug":"output","index":2},{"name":"status","type":"*","group":"Inputs","plug":"input","index":2},{"name":"Page","type":"*","plug":"output","index":3},{"name":"ProvinceId","type":"*","group":"Inputs","plug":"input","index":3},{"name":"PageSize","type":"*","plug":"output","index":4},{"name":"keyword","type":"*","group":"Inputs","plug":"input","index":4},{"name":"total","type":"*","plug":"output","index":5},{"name":"Do","type":{"name":"signal","allowConnectionsOnly":true},"group":"Actions","plug":"input","index":5},{"name":"page","type":"*","group":"Inputs","plug":"input","index":6},{"name":"limit","type":"*","group":"Inputs","plug":"input","index":7}],"roots":[]}]